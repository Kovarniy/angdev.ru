# –ü–∞—Ç—Ç–µ—Ä–Ω—ã –¥–ª—è –∞–≤—Ç–æ–Ω–æ–º–Ω—ã—Ö API

–í–º–µ—Å—Ç–µ —Å –∞–≤—Ç–æ–Ω–æ–º–Ω—ã–º–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏ –∫–æ–º–∞–Ω–¥–∞ Angular –ø—Ä–µ–¥—Å—Ç–∞–≤–∏–ª–∞ –∞–≤—Ç–æ–Ω–æ–º–Ω—ã–µ API. –û–Ω–∏ –ø–æ–∑–≤–æ–ª—è—é—Ç –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –±–æ–ª–µ–µ –ª–µ–≥–∫–∏–º —Å–ø–æ—Å–æ–±–æ–º. –ü—Ä–∏–º–µ—Ä–∞–º–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—â–∏—Ö Standalone API, –Ω–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç —è–≤–ª—è—é—Ç—Å—è `HttpClient` –∏ `Router`. –¢–∞–∫–∂–µ —Ä–∞–Ω–Ω–∏–º –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª–µ–º —ç—Ç–æ–π –∏–¥–µ–∏ —è–≤–ª—è–µ—Ç—Å—è NGRX.

–í —ç—Ç–æ–π –≥–ª–∞–≤–µ —è –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –¥–ª—è –Ω–∞–ø–∏—Å–∞–Ω–∏—è —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã—Ö Standalone API, –≤–∑—è—Ç—ã—Ö –∏–∑ –≤—ã—à–µ—É–ø–æ–º—è–Ω—É—Ç—ã—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–∞—Ç—Ç–µ—Ä–Ω–∞ –æ–±—Å—É–∂–¥–∞—é—Ç—Å—è —Å–ª–µ–¥—É—é—â–∏–µ –∞—Å–ø–µ–∫—Ç—ã: –Ω–∞–º–µ—Ä–µ–Ω–∏—è, –ª–µ–∂–∞—â–∏–µ –≤ –æ—Å–Ω–æ–≤–µ –ø–∞—Ç—Ç–µ—Ä–Ω–∞, –æ–ø–∏—Å–∞–Ω–∏–µ, –ø—Ä–∏–º–µ—Ä —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏, –ø—Ä–∏–º–µ—Ä—ã, –≤—Å—Ç—Ä–µ—á–∞—é—â–∏–µ—Å—è –≤ —É–ø–æ–º—è–Ω—É—Ç—ã—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫–∞—Ö, –∏ –≤–∞—Ä–∏–∞—Ü–∏–∏ –¥–µ—Ç–∞–ª–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏.

–ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –∏–∑ —ç—Ç–∏—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –æ—Å–æ–±–µ–Ω–Ω–æ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã –¥–ª—è –∞–≤—Ç–æ—Ä–æ–≤ –±–∏–±–ª–∏–æ—Ç–µ–∫. –û–Ω–∏ —Å–ø–æ—Å–æ–±–Ω—ã —É–ª—É—á—à–∏—Ç—å DX –¥–ª—è –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–µ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏. –° –¥—Ä—É–≥–æ–π —Å—Ç–æ—Ä–æ–Ω—ã, –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –∏–∑ –Ω–∏—Ö –º–æ–≥—É—Ç –æ–∫–∞–∑–∞—Ç—å—Å—è –∏–∑–ª–∏—à–Ω–∏–º–∏ –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π.

> –ë–æ–ª—å—à–æ–µ —Å–ø–∞—Å–∏–±–æ [–ê–ª–µ–∫—Å—É –†–∏–∫–∞–±–æ](https://twitter.com/synalx) –∏–∑ Angular –∑–∞ –≤—ã—á–∏—Ç–∫—É –∏ –æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å!

üìÇ [–ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–π –≤ –ø—Ä–∏–º–µ—Ä–∞—Ö](https://github.com/manfredsteyer/standalone-example-cli.git)

## –ü—Ä–∏–º–µ—Ä –¥–ª—è –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ {#leanpub-auto-case-study-for-patterns}

–î–ª—è –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –≤—ã–≤–µ–¥–µ–Ω–Ω—ã—Ö –∑–∞–∫–æ–Ω–æ–º–µ—Ä–Ω–æ—Å—Ç–µ–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–æ—Å—Ç–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –ª–æ–≥–≥–µ—Ä–æ–≤. –≠—Ç–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –Ω–∞—Å—Ç–æ–ª—å–∫–æ –ø—Ä–æ—Å—Ç–∞, –Ω–∞—Å–∫–æ–ª—å–∫–æ —ç—Ç–æ –≤–æ–∑–º–æ–∂–Ω–æ, –Ω–æ –Ω–∞—Å—Ç–æ–ª—å–∫–æ —Å–ª–æ–∂–Ω–∞, –Ω–∞—Å–∫–æ–ª—å–∫–æ —ç—Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤.

–ö–∞–∂–¥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∂—É—Ä–Ω–∞–ª–∞ –∏–º–µ–µ—Ç `LogLevel`, –æ–ø—Ä–µ–¥–µ–ª—è–µ–º—ã–π –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏–µ–º:

```ts
export enum LogLevel {
    DEBUG = 0,
    INFO = 1,
    ERROR = 2,
}
```

–î–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã –º—ã –æ–≥—Ä–∞–Ω–∏—á–∏–º –Ω–∞—à—É –±–∏–±–ª–∏–æ—Ç–µ–∫—É Logger —Ç–æ–ª—å–∫–æ —Ç—Ä–µ–º—è —É—Ä–æ–≤–Ω—è–º–∏ –∂—É—Ä–Ω–∞–ª–∞.

–ê–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π `LoggerConfig` –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –≤–æ–∑–º–æ–∂–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:

```ts
export abstract class LoggerConfig {
    abstract level: LogLevel;
    abstract formatter: Type<LogFormatter>;
    abstract appenders: Type<LogAppender>[];
}
```

–≠—Ç–æ –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π –∫–ª–∞—Å—Å, —Ç–∞–∫ –∫–∞–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –Ω–µ –º–æ–≥—É—Ç –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã –≤ –∫–∞—á–µ—Å—Ç–≤–µ –º–∞—Ä–∫–µ—Ä–æ–≤ –¥–ª—è DI. –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∞ —ç—Ç–æ–≥–æ –∫–ª–∞—Å—Å–∞ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:

```ts
export const defaultConfig: LoggerConfig = {
    level: LogLevel.DEBUG,
    formatter: DefaultLogFormatter,
    appenders: [DefaultLogAppender],
};
```

–§–æ—Ä–º–∞—Ç—Ç–µ—Ä `LogFormatter` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π –∂—É—Ä–Ω–∞–ª–∞ –ø–µ—Ä–µ–¥ –∏—Ö –ø—É–±–ª–∏–∫–∞—Ü–∏–µ–π —á–µ—Ä–µ–∑ `LogAppender`:

```ts
export abstract class LogFormatter {
    abstract format(
        level: LogLevel,
        category: string,
        msg: string
    ): string;
}
```

–ö–∞–∫ –∏ `LoggerConfiguration`, `LogFormatter` ‚Äî —ç—Ç–æ –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π –∫–ª–∞—Å—Å, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –≤ –∫–∞—á–µ—Å—Ç–≤–µ –º–∞—Ä–∫–µ—Ä–∞. –ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –ª–æ–≥–≥–µ—Ä–æ–≤ –º–æ–∂–µ—Ç –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏–≤ —Å–≤–æ—é —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é. –í –∫–∞—á–µ—Å—Ç–≤–µ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã –æ–Ω–∏ –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ–º—É—é –±–∏–±–ª–∏–æ—Ç–µ–∫–æ–π:

```ts
@Injectable()
export class DefaultLogFormatter implements LogFormatter {
    format(
        level: LogLevel,
        category: string,
        msg: string
    ): string {
        const levelString = LogLevel[level].padEnd(5);
        return `[${levelString}] ${category.toUpperCase()} ${msg}`;
    }
}
```

`LogAppender` ‚Äî —ç—Ç–æ –µ—â–µ –æ–¥–Ω–∞ —Å–º–µ–Ω–Ω–∞—è –∫–æ–Ω—Ü–µ–ø—Ü–∏—è, –æ—Ç–≤–µ—á–∞—é—â–∞—è –∑–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∂—É—Ä–Ω–∞–ª–∞ –≤ –∂—É—Ä–Ω–∞–ª:

```ts
export abstract class LogAppender {
    abstract append(
        level: LogLevel,
        category: string,
        msg: string
    ): void;
}
```

–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –∫–æ–Ω—Å–æ–ª—å:

```ts
@Injectable()
export class DefaultLogAppender implements LogAppender {
    append(
        level: LogLevel,
        category: string,
        msg: string
    ): void {
        console.log(category + ' ' + msg);
    }
}
```

–•–æ—Ç—è –º–æ–∂–µ—Ç –±—ã—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω `LogFormatter`, –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ `LogAppender`. –ù–∞–ø—Ä–∏–º–µ—Ä, –ø–µ—Ä–≤—ã–π `LogAppender` –º–æ–∂–µ—Ç –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –∫–æ–Ω—Å–æ–ª—å, –∞ –≤—Ç–æ—Ä–æ–π ‚Äî –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –µ–≥–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä.

–ß—Ç–æ–±—ã —Å–¥–µ–ª–∞—Ç—å —ç—Ç–æ –≤–æ–∑–º–æ–∂–Ω—ã–º, –æ—Ç–¥–µ–ª—å–Ω—ã–µ `LogAppender`—ã —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ –º—É–ª—å—Ç–∏–ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤. –ü–æ—ç—Ç–æ–º—É –∏–Ω–∂–µ–∫—Ç–æ—Ä –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏—Ö –≤—Å–µ –≤ –º–∞—Å—Å–∏–≤–µ. –ü–æ—Å–∫–æ–ª—å–∫—É –º–∞—Å—Å–∏–≤ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –≤ –∫–∞—á–µ—Å—Ç–≤–µ DI-—Ç–æ–∫–µ–Ω–∞, –≤ –ø—Ä–∏–º–µ—Ä–µ –≤–º–µ—Å—Ç–æ –Ω–µ–≥–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `InjectionToken`:

```ts
export const LOG_APPENDERS = new InjectionToken<
    LogAppender[]
>('LOG_APPENDERS');
```

–°–∞–º `LoggserService` –ø–æ–ª—É—á–∞–µ—Ç `LoggerConfig`, `LogFormatter` –∏ –º–∞—Å—Å–∏–≤ —Å `LogAppenders` —á–µ—Ä–µ–∑ DI –∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö `LogLevels`:

```ts
@Injectable()
export class LoggerService {
    private config = inject(LoggerConfig);
    private formatter = inject(LogFormatter);
    private appenders = inject(LOG_APPENDERS);

    log(
        level: LogLevel,
        category: string,
        msg: string
    ): void {
        if (level < this.config.level) {
            return;
        }
        const formatted = this.formatter.format(
            level,
            category,
            msg
        );
        for (const a of this.appenders) {
            a.append(level, category, formatted);
        }
    }

    error(category: string, msg: string): void {
        this.log(LogLevel.ERROR, category, msg);
    }

    info(category: string, msg: string): void {
        this.log(LogLevel.INFO, category, msg);
    }

    debug(category: string, msg: string): void {
        this.log(LogLevel.DEBUG, category, msg);
    }
}
```

## –ó–æ–ª–æ—Ç–æ–µ –ø—Ä–∞–≤–∏–ª–æ {#leanpub-auto-the-golden-rule}

–ü—Ä–µ–∂–¥–µ —á–µ–º –ø—Ä–∏—Å—Ç—É–ø–∏—Ç—å –∫ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—é –≤—ã–≤–µ–¥–µ–Ω–Ω—ã—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤, —è —Ö–æ—á—É –ø–æ–¥—á–µ—Ä–∫–Ω—É—Ç—å —Ç–æ, —á—Ç–æ —è –Ω–∞–∑—ã–≤–∞—é –∑–æ–ª–æ—Ç—ã–º –ø—Ä–∞–≤–∏–ª–æ–º –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤:

> –í—Å–µ–≥–¥–∞, –∫–æ–≥–¥–∞ —ç—Ç–æ –≤–æ–∑–º–æ–∂–Ω–æ, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `@Injectable({providedIn: 'root'})`!

–û—Å–æ–±–µ–Ω–Ω–æ –≤ –∫–æ–¥–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π, –Ω–æ –≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Å–∏—Ç—É–∞—Ü–∏—è—Ö –∏ –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞—Ö, —ç—Ç–æ —Ç–æ, —á—Ç–æ –≤—ã —Ö–æ—Ç–∏—Ç–µ –∏–º–µ—Ç—å: –≠—Ç–æ –ª–µ–≥–∫–æ, –¥—Ä–µ–≤–æ–≤–∏–¥–Ω–æ –∏ –¥–∞–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –ª–µ–Ω–∏–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–æ–π. –ü–æ—Å–ª–µ–¥–Ω–∏–π –∞—Å–ø–µ–∫—Ç ‚Äî –∑–∞—Å–ª—É–≥–∞ –Ω–µ —Å—Ç–æ–ª—å–∫–æ Angular, —Å–∫–æ–ª—å–∫–æ –ª–µ–∂–∞—â–µ–≥–æ –≤ –µ–≥–æ –æ—Å–Ω–æ–≤–µ –±–∞–Ω–¥–ª–µ—Ä–∞: –í—Å–µ, —á—Ç–æ –ø—Ä–æ—Å—Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤ –ª–µ–Ω–∏–≤–æ–º –±–∞–Ω–¥–ª–µ, –ø–æ–º–µ—â–µ–Ω–æ —Ç—É–¥–∞.

## –ü–∞—Ç—Ç–µ—Ä–Ω: –§–∞–±—Ä–∏–∫–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ {#leanpub-auto-pattern-provider-factory}

**–ù–∞–º–µ—Ä–µ–Ω–∏—è**

-   –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–≤ –¥–ª—è –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
-   –ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
-   –û–±–º–µ–Ω –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–º–∏ –¥–µ—Ç–∞–ª—è–º–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

**–û–ø–∏—Å–∞–Ω–∏–µ**

–§–∞–±—Ä–∏–∫–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ ‚Äî —ç—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è, –≤–æ–∑–≤—Ä–∞—â–∞—é—â–∞—è –º–∞—Å—Å–∏–≤ —Å –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º–∏ –¥–ª—è –∑–∞–¥–∞–Ω–Ω–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏. –≠—Ç–æ—Ç –º–∞—Å—Å–∏–≤ –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç—Å—è –≤ —Ç–∏–ø Angular `EnvironmentProviders`, —á—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã –º–æ–≥—É—Ç –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã —Ç–æ–ª—å–∫–æ –≤ –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è ‚Äî –≤ –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å, –≤ –∫–æ—Ä–Ω–µ–≤–æ–π –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏ –∏ –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏, –≤–≤–µ–¥–µ–Ω–Ω–æ–π —Å –ø–æ–º–æ—â—å—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π –ª–µ–Ω–∏–≤–æ–π –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏.

Angular –∏ NGRX —Ä–∞–∑–º–µ—â–∞—é—Ç —Ç–∞–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤ —Ñ–∞–π–ª–∞—Ö –ø–æ–¥ –Ω–∞–∑–≤–∞–Ω–∏–µ–º `provider.ts`.

**–ü—Ä–∏–º–µ—Ä**

–°–ª–µ–¥—É—é—â–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ `provideLogger` –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —á–∞—Å—Ç–∏—á–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é `LoggerConfiguration` –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –µ–µ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤:

```ts
export function provideLogger(
    config: Partial<LoggerConfig>
): EnvironmentProviders {
    // using default values for missing properties
    const merged = { ...defaultConfig, ...config };

    return makeEnvironmentProviders([
        {
            provide: LoggerConfig,
            useValue: merged,
        },
        {
            provide: LogFormatter,
            useClass: merged.formatter,
        },
        merged.appenders.map((a) => ({
            provide: LOG_APPENDERS,
            useClass: a,
            multi: true,
        })),
    ]);
}
```

–ù–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –±–µ—Ä—É—Ç—Å—è –∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é. Angular's `makeEnvironmentProviders` –æ–±–æ—Ä–∞—á–∏–≤–∞–µ—Ç –º–∞—Å—Å–∏–≤ `Provider` –≤ —ç–∫–∑–µ–º–ø–ª—è—Ä `EnvironmentProviders`.

–≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ—Ç—Ä–µ–±–ª—è—é—â–µ–º—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ª–æ–≥–≥–µ—Ä –≤–æ –≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏, –∫–∞–∫ –∏ –¥—Ä—É–≥–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä, `HttpClient` –∏–ª–∏ `Router`:

```ts
bootstrapApplication(AppComponent, {
    providers: [
        provideHttpClient(),

        provideRouter(APP_ROUTES),

        /* [...] */

        // Setting up the Logger:
        provideLogger(loggerConfig),
    ],
});
```

**–°–ª—É—á–∞–∏ –∏ –≤–∞—Ä–∏–∞—Ü–∏–∏**

-   –≠—Ç–æ –æ–±—ã—á–Ω—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –≤–æ –≤—Å–µ—Ö —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫–∞—Ö.
-   –§–∞–±—Ä–∏–∫–∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ –¥–ª—è `Router` –∏ `HttpClient` –∏–º–µ—é—Ç –≤—Ç–æ—Ä–æ–π –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ (—Å–º. –ø–∞—Ç—Ç–µ—Ä–Ω _Feature_, –Ω–∏–∂–µ).
-   –í–º–µ—Å—Ç–æ –ø–µ—Ä–µ–¥–∞—á–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–µ—Ä–≤–∏—Å–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä, LogFormatter, NGRX –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å –ª–∏–±–æ —Ç–æ–∫–µ–Ω, –ª–∏–±–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –æ–±—ä–µ–∫—Ç –¥–ª—è —Ä–µ–¥—É–∫—Ç–æ—Ä–æ–≤.
-   –í `HttpClient` –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –º–∞—Å—Å–∏–≤ —Å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–º–∏ –ø–µ—Ä–µ—Ö–≤–∞—Ç—á–∏–∫–∞–º–∏ —á–µ—Ä–µ–∑ —Ñ—É–Ω–∫—Ü–∏—é `with` (—Å–º. –ø–∞—Ç—Ç–µ—Ä–Ω _Feature_, –Ω–∏–∂–µ). –≠—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–∏ —Ç–∞–∫–∂–µ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—Ç—Å—è –∫–∞–∫ —Å–µ—Ä–≤–∏—Å—ã.

## –ü–∞—Ç—Ç–µ—Ä–Ω: –§—É–Ω–∫—Ü–∏—è {#leanpub-auto-pattern-feature}

**–ù–∞–º–µ—Ä–µ–Ω–∏—è**

-   –ê–∫—Ç–∏–≤–∞—Ü–∏—è –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
-   –°–¥–µ–ª–∞—Ç—å —ç—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑–º–µ–Ω—è–µ–º—ã–º–∏ –≤ –¥–µ—Ä–µ–≤–µ
-   –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –±–∞–∑–æ–≤—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ —á–µ—Ä–µ–∑ —Ç–µ–∫—É—â–µ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ

**–û–ø–∏—Å–∞–Ω–∏–µ**

–§–∞–±—Ä–∏–∫–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –º–∞—Å—Å–∏–≤ —Å –æ–±—ä–µ–∫—Ç–æ–º —Ñ—É–Ω–∫—Ü–∏–∏. –ö–∞–∂–¥—ã–π –æ–±—ä–µ–∫—Ç —Ñ—É–Ω–∫—Ü–∏–∏ –∏–º–µ–µ—Ç –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä `kind` –∏ –º–∞—Å—Å–∏–≤ `providers`. –°–≤–æ–π—Å—Ç–≤–æ `kind` –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–º–±–∏–Ω–∞—Ü–∏—é –ø–µ—Ä–µ–¥–∞–≤–∞–µ–º—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π. –ù–∞–ø—Ä–∏–º–µ—Ä, –º–æ–≥—É—Ç –±—ã—Ç—å –≤–∑–∞–∏–º–æ–∏—Å–∫–ª—é—á–∞—é—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏, —Ç–∞–∫–∏–µ –∫–∞–∫ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–æ–∫–µ–Ω–æ–≤ XSRF –∏ –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–æ–∫–µ–Ω–æ–≤ XSRF –¥–ª—è `HttpClient`.

**–ü—Ä–∏–º–µ—Ä**

–í –Ω–∞—à–µ–º –ø—Ä–∏–º–µ—Ä–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏—è —Ü–≤–µ—Ç–∞, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è —Ä–∞–∑–Ω—ã—Ö `LoggerLevel` —Ä–∞–∑–Ω—ã–º–∏ —Ü–≤–µ—Ç–∞–º–∏:

–î–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏–∏ —Ñ—É–Ω–∫—Ü–∏–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏–µ:

```ts
export enum LoggerFeatureKind {
    COLOR,
    OTHER_FEATURE,
    ADDITIONAL_FEATURE,
}
```

–ö–∞–∂–¥—ã–π –ø—Ä–∏–∑–Ω–∞–∫ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω –æ–±—ä–µ–∫—Ç–æ–º `LoggerFeature`:

```ts
export interface LoggerFeature {
    kind: LoggerFeatureKind;
    providers: Provider[];
}
```

–î–ª—è –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è —Ü–≤–µ—Ç–æ–≤–æ–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –≤–≤–æ–¥–∏—Ç—Å—è —Ñ–∞–±—Ä–∏—á–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è, —Å–ª–µ–¥—É—é—â–∞—è —à–∞–±–ª–æ–Ω—É –∏–º–µ–Ω–æ–≤–∞–Ω–∏—è _Feature_:

```ts
export function withColor(
    config?: Partial<ColorConfig>
): LoggerFeature {
    const internal = { ...defaultColorConfig, ...config };

    return {
        kind: LoggerFeatureKind.COLOR,
        providers: [
            {
                provide: ColorConfig,
                useValue: internal,
            },
            {
                provide: ColorService,
                useClass: DefaultColorService,
            },
        ],
    };
}
```

–§–∞–±—Ä–∏–∫–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ñ—É–Ω–∫—Ü–∏–π —á–µ—Ä–µ–∑ –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –≤—Ç–æ—Ä–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä, –∑–∞–¥–∞–Ω–Ω—ã–π –≤ –≤–∏–¥–µ –º–∞—Å—Å–∏–≤–∞ rest:

```ts
export function provideLogger(
    config: Partial<LoggerConfig>,
    ...features: LoggerFeature[]
): EnvironmentProviders {
    const merged = { ...defaultConfig, ...config };

    // Inspecting passed features
    const colorFeatures =
        features?.filter(
            (f) => f.kind === LoggerFeatureKind.COLOR
        )?.length ?? 0;

    // Validating passed features
    if (colorFeatures > 1) {
        throw new Error(
            'Only one color feature allowed for logger!'
        );
    }

    return makeEnvironmentProviders([
        {
            provide: LoggerConfig,
            useValue: merged,
        },
        {
            provide: LogFormatter,
            useClass: merged.formatter,
        },
        merged.appenders.map((a) => ({
            provide: LOG_APPENDERS,
            useClass: a,
            multi: true,
        })),

        // Providing services for the features
        features?.map((f) => f.providers),
    ]);
}
```

–°–≤–æ–π—Å—Ç–≤–æ `kind` —Ñ—É–Ω–∫—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π. –ï—Å–ª–∏ –≤—Å–µ –≤ –ø–æ—Ä—è–¥–∫–µ, –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã, –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –≤ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–µ, –ø–æ–º–µ—â–∞—é—Ç—Å—è –≤ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–π –æ–±—ä–µ–∫—Ç `EnvironmentProviders`.

–í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –∏–Ω—ä–µ–∫—Ü–∏–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π `DefaultLogAppender` –ø–æ–ª—É—á–∞–µ—Ç `ColorService`, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ–º—ã–π —Ñ—É–Ω–∫—Ü–∏–µ–π —Ü–≤–µ—Ç–∞:

```ts
export class DefaultLogAppender implements LogAppender {
    colorService = inject(ColorService, { optional: true });

    append(
        level: LogLevel,
        category: string,
        msg: string
    ): void {
        if (this.colorService) {
            msg = this.colorService.apply(level, msg);
        }
        console.log(msg);
    }
}
```

–ü–æ—Å–∫–æ–ª—å–∫—É —Ñ—É–Ω–∫—Ü–∏–∏ —è–≤–ª—è—é—Ç—Å—è –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º–∏, `DefaultLogAppender` –ø–µ—Ä–µ–¥–∞–µ—Ç `optional: true` –≤ `inject`. –í –ø—Ä–æ—Ç–∏–≤–Ω–æ–º —Å–ª—É—á–∞–µ –º—ã –ø–æ–ª—É—á–∏–ª–∏ –±—ã –∏—Å–∫–ª—é—á–µ–Ω–∏–µ, –µ—Å–ª–∏ –±—ã —Ñ—É–Ω–∫—Ü–∏—è –Ω–µ –±—ã–ª–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞. –ö—Ä–æ–º–µ —Ç–æ–≥–æ, `DefaultLogAppender` –¥–æ–ª–∂–µ–Ω –ø—Ä–æ–≤–µ—Ä—è—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è `null`.

**–°–ª—É—á–∞–∏ –∏ –≤–∞—Ä–∏–∞—Ü–∏–∏**

-   –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä `Router` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –µ–≥–æ, –Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –∏–ª–∏ –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏ –æ—Ç–ª–∞–¥–∫–∏.
-   `HttpClient` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –µ–≥–æ, –Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –ø–µ—Ä–µ—Ö–≤–∞—Ç—á–∏–∫–æ–≤, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ JSONP –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏/–æ—Ç–∫–ª—é—á–µ–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–æ–∫–µ–Ω–æ–≤ XSRF.
-   –ò `Router`, –∏ `HttpClient` –æ–±—ä–µ–¥–∏–Ω—è—é—Ç –≤–æ–∑–º–æ–∂–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –≤ —Å–æ—é–∑–Ω—ã–π —Ç–∏–ø (–Ω–∞–ø—Ä–∏–º–µ—Ä, `export type AllowedFeatures = ThisFeature | ThatFeature`). –≠—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç IDE –ø—Ä–µ–¥–ª–∞–≥–∞—Ç—å –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏.
-   –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∏–Ω–∂–µ–∫—Ç–∏—Ä—É—é—Ç —Ç–µ–∫—É—â–∏–π `Injector` –∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –µ–≥–æ, —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å, –∫–∞–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –±—ã–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã. –≠—Ç–æ –∏–º–ø–µ—Ä–∞—Ç–∏–≤–Ω–∞—è –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é `optional: true`.
-   –í —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è—Ö —Ñ—É–Ω–∫—Ü–∏–π Angular —Å–≤–æ–π—Å—Ç–≤–∞ `kind` –∏ `providers` –ø—Ä–µ—Ñ–∏–∫—Å–∏—Ä—É—é—Ç—Å—è `…µ` –∏, —Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ, –æ–±—ä—è–≤–ª—è—é—Ç—Å—è –∫–∞–∫ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —Å–≤–æ–π—Å—Ç–≤–∞.

## –ü–∞—Ç—Ç–µ—Ä–Ω: –§–∞–±—Ä–∏–∫–∞ –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ {#leanpub-auto-pattern-configuration-provider-factory}

**–ù–∞–º–µ—Ä–µ–Ω–∏—è**

-   –ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
-   –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ –∏ –∏—Ö —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Å–µ—Ä–≤–∏—Å–∞—Ö
-   –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –ø–æ–≤–µ–¥–µ–Ω–∏—è —Å–µ—Ä–≤–∏—Å–∞ –∏–∑ –≤–ª–æ–∂–µ–Ω–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è.

**–û–ø–∏—Å–∞–Ω–∏–µ**

–§–∞–±—Ä–∏–∫–∏ –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Ä–∞—Å—à–∏—Ä—è—é—Ç –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å–ª—É–∂–±—ã. –û–Ω–∏ –º–æ–≥—É—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `ENVIRONMENT_INITIALIZER` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ –∫–∞–∫ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ–º—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤, —Ç–∞–∫ –∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è.

**–ü—Ä–∏–º–µ—Ä**

–ü—Ä–µ–¥–ø–æ–ª–æ–∂–∏–º, —á—Ç–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è –Ω–∞—à–µ–≥–æ `LoggerService` –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π `LogAppender` –¥–ª—è –∫–∞–∂–¥–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∂—É—Ä–Ω–∞–ª–æ–≤:

```ts
@Injectable()
export class LoggerService {
    private appenders = inject(LOG_APPENDERS);
    private formatter = inject(LogFormatter);
    private config = inject(LoggerConfig);
    /* [...] */

    // Additional LogAppender per log category
    readonly categories: Record<string, LogAppender> = {};

    log(
        level: LogLevel,
        category: string,
        msg: string
    ): void {
        if (level < this.config.level) {
            return;
        }

        const formatted = this.formatter.format(
            level,
            category,
            msg
        );

        // Lookup appender for this very category and use
        // it, if there is one:
        const catAppender = this.categories[category];

        if (catAppender) {
            catAppender.append(level, category, formatted);
        }

        // Also, use default appenders:
        for (const a of this.appenders) {
            a.append(level, category, formatted);
        }
    }

    /* [...] */
}
```

–ß—Ç–æ–±—ã —Å–∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞—Ç—å `LogAppender` –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, –º—ã –º–æ–∂–µ–º –≤–≤–µ—Å—Ç–∏ –µ—â–µ –æ–¥–Ω—É —Ñ–∞–±—Ä–∏–∫—É –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤:

```ts
export function provideCategory(
    category: string,
    appender: Type<LogAppender>
): EnvironmentProviders {
    // Internal/ Local token for registering the service
    // and retrieving the resolved service instance
    // immediately after.
    const appenderToken = new InjectionToken<LogAppender>(
        'APPENDER_' + category
    );

    return makeEnvironmentProviders([
        {
            provide: appenderToken,
            useClass: appender,
        },
        {
            provide: ENVIRONMENT_INITIALIZER,
            multi: true,
            useValue: () => {
                const appender = inject(appenderToken);
                const logger = inject(LoggerService);

                logger.categories[category] = appender;
            },
        },
    ]);
}
```

–≠—Ç–∞ —Ñ–∞–±—Ä–∏–∫–∞ —Å–æ–∑–¥–∞–µ—Ç –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –¥–ª—è –∫–ª–∞—Å—Å–∞ `LogAppender`. –û–¥–Ω–∞–∫–æ –Ω–∞–º –Ω—É–∂–µ–Ω –Ω–µ —Å–∞–º –∫–ª–∞—Å—Å, –∞ –µ–≥–æ —ç–∫–∑–µ–º–ø–ª—è—Ä. –¢–∞–∫–∂–µ –Ω–∞–º –Ω—É–∂–µ–Ω `Injector` –¥–ª—è —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π —ç—Ç–æ–≥–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞. –ò —Ç–æ, –∏ –¥—Ä—É–≥–æ–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ `LogAppender` —á–µ—Ä–µ–∑ –∏–Ω–∂–µ–∫—Ç–æ—Ä.

–ò–º–µ–Ω–Ω–æ —ç—Ç–æ –∏ –¥–µ–ª–∞–µ—Ç `ENVIRONMENT_INITIALIZER`, –∫–æ—Ç–æ—Ä—ã–π —è–≤–ª—è–µ—Ç—Å—è –º—É–ª—å—Ç–∏–ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–º, –ø—Ä–∏–≤—è–∑–∞–Ω–Ω—ã–º –∫ —Ç–æ–∫–µ–Ω—É `ENVIRONMENT_INITIALIZER` –∏ —É–∫–∞–∑—ã–≤–∞—é—â–∏–º –Ω–∞ —Ñ—É–Ω–∫—Ü–∏—é. –û–Ω–∞ –ø–æ–ª—É—á–∞–µ—Ç –∏–Ω–∂–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π `LogAppender`, –∞ —Ç–∞–∫–∂–µ `LoggerService`. –ó–∞—Ç–µ–º `LogAppender` —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è –≤ –ª–æ–≥–≥–µ—Ä–µ.

–≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ä–∞—Å—à–∏—Ä–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π `LoggerService`, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç –¥–∞–∂–µ –∏—Å—Ö–æ–¥–∏—Ç—å –∏–∑ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–π –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏. –ù–∞–ø—Ä–∏–º–µ—Ä, –≤ —Å–ª–µ–¥—É—é—â–µ–º –ø—Ä–∏–º–µ—Ä–µ –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è, —á—Ç–æ `LoggerService` –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –∫–æ—Ä–Ω–µ–≤–æ–π –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏, –∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è –∂—É—Ä–Ω–∞–ª–∞ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –≤ –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏ –ª–µ–Ω–∏–≤–æ–≥–æ –º–∞—Ä—à—Ä—É—Ç–∞:

```ts
export const FLIGHT_BOOKING_ROUTES: Routes = [
    {
        path: '',
        component: FlightBookingComponent,

        // Providers for this route and child routes
        // Using the providers array sets up a new
        // environment injector for this part of the
        // application.
        providers: [
            // Setting up an NGRX feature slice
            provideState(bookingFeature),
            provideEffects([BookingEffects]),

            // Provide LogAppender for logger category
            provideCategory('booking', DefaultLogAppender),
        ],
        children: [
            {
                path: 'flight-search',
                component: FlightSearchComponent,
            },
            /* [...] */
        ],
    },
];
```

**–°–ª—É—á–∞–∏ –∏ –≤–∞—Ä–∏–∞—Ü–∏–∏**

-   `@ngrx/store` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —ç—Ç–æ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤ —Ñ—É–Ω–∫—Ü–∏–π
-   `@ngrx/effects` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —ç—Ç–æ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —ç—Ñ—Ñ–µ–∫—Ç–æ–≤, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ–º—ã—Ö —Ñ—É–Ω–∫—Ü–∏–µ–π.
-   –§—É–Ω–∫—Ü–∏—è `withDebugTracing` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —ç—Ç–æ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω, —á—Ç–æ–±—ã –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –Ω–∞–±–ª—é–¥–∞–µ–º—É—é `events` –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä–∞.

## –ü–∞—Ç—Ç–µ—Ä–Ω: NgModule Bridge {#leanpub-auto-pattern-ngmodule-bridge}

**–ù–∞–º–µ—Ä–µ–Ω–∏—è**

-   –ù–µ –ª–æ–º–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–π `NgModules` –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –Ω–∞ Standalone API.
-   –ü–æ–∑–≤–æ–ª—è–µ—Ç —Ç–∞–∫–∏–º —á–∞—Å—Ç—è–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å `EnvironmentProviders`, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–∏—Ö–æ–¥—è—Ç –∏–∑ Provider Factory.

–ó–∞–º–µ—á–∞–Ω–∏—è: –î–ª—è –Ω–æ–≤–æ–≥–æ –∫–æ–¥–∞ —ç—Ç–æ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω –∫–∞–∂–µ—Ç—Å—è –∏–∑–ª–∏—à–Ω–∏–º, –ø–æ—Å–∫–æ–ª—å–∫—É —Ñ–∞–±—Ä–∏–∫–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤—ã–∑–≤–∞–Ω–∞ –Ω–∞–ø—Ä—è–º—É—é –¥–ª—è –ø–æ—Ç—Ä–µ–±–ª—è—é—â–∏—Ö (—É–Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–Ω—ã—Ö) NgModules.

**–û–ø–∏—Å–∞–Ω–∏–µ**

–ú–æ—Å—Ç NgModule Bridge ‚Äî —ç—Ç–æ NgModule, –ø–æ–ª—É—á–∞—é—â–∏–π (–Ω–µ–∫–æ—Ç–æ—Ä—ã–µ) —Å–≤–æ–∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã —á–µ—Ä–µ–∑ —Ñ–∞–±—Ä–∏–∫—É –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ (—Å–º. –ø–∞—Ç—Ç–µ—Ä–Ω _–§–∞–±—Ä–∏–∫–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤_). –ß—Ç–æ–±—ã –¥–∞—Ç—å –≤—ã–∑—ã–≤–∞—é—â–µ–º—É –º–æ–¥—É–ª—é –±–æ–ª—å—à–µ –∫–æ–Ω—Ç—Ä–æ–ª—è –Ω–∞–¥ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ–º—ã–º–∏ —É—Å–ª—É–≥–∞–º–∏, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Ç–æ–¥—ã —Ç–∏–ø–∞ `forRoot`. –≠—Ç–∏ –º–µ—Ç–æ–¥—ã –º–æ–≥—É—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å –æ–±—ä–µ–∫—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.

**–ü—Ä–∏–º–µ—Ä**

–°–ª–µ–¥—É—é—â–∏–π `NgModules` –ø–æ–∑–≤–æ–ª—è–µ—Ç –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ª–æ–≥–≥–µ—Ä —Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º:

```ts
@NgModule({
    imports: [
        /* your imports here */
    ],
    exports: [
        /* your exports here */
    ],
    declarations: [
        /* your delarations here */
    ],
    providers: [
        /* providers, you _always_ want to get, here */
    ],
})
export class LoggerModule {
    static forRoot(
        config = defaultConfig
    ): ModuleWithProviders<LoggerModule> {
        return {
            ngModule: LoggerModule,
            providers: [provideLogger(config)],
        };
    }

    static forCategory(
        category: string,
        appender: Type<LogAppender>
    ): ModuleWithProviders<LoggerModule> {
        return {
            ngModule: LoggerModule,
            providers: [
                provideCategory(category, appender),
            ],
        };
    }
}
```

–ß—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Ñ–∞–±—Ä–∏–∫ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤, –º–µ—Ç–æ–¥—ã –º–æ–¥—É–ª—è –¥–µ–ª–µ–≥–∏—Ä—É—é—Ç—Å—è –∏–º. –ü–æ—Å–∫–æ–ª—å–∫—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–∞–∫–∏—Ö –º–µ—Ç–æ–¥–æ–≤ —è–≤–ª—è–µ—Ç—Å—è –æ–±—ã—á–Ω—ã–º –¥–µ–ª–æ–º –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å NgModules, –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏ –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∑–Ω–∞–Ω–∏—è –∏ —Å–æ–≥–ª–∞—à–µ–Ω–∏—è.

**–°–ª—É—á–∞–∏ –∏ –≤–∞—Ä–∏–∞—Ü–∏–∏**

-   –í—Å–µ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç —ç—Ç–æ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏

## –ü–∞—Ç—Ç–µ—Ä–Ω: –¶–µ–ø–æ—á–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤ {#leanpub-auto-pattern-service-chain}

**–ù–∞–º–µ—Ä–µ–Ω–∏—è**

-   –î–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞ –¥—Ä—É–≥–æ–º—É —Å–≤–æ–µ–º—É —ç–∫–∑–µ–º–ø–ª—è—Ä—É –≤ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–π –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏.

**–û–ø–∏—Å–∞–Ω–∏–µ**

–ö–æ–≥–¥–∞ –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ —Å–µ—Ä–≤–∏—Å —Ä–∞–∑–º–µ—â–∞–µ—Ç—Å—è –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö –∏–Ω–∂–µ–∫—Ç–æ—Ä–∞—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è, –º—ã –æ–±—ã—á–Ω–æ –ø–æ–ª—É—á–∞–µ–º —Ç–æ–ª—å–∫–æ —ç–∫–∑–µ–º–ø–ª—è—Ä —Å–µ—Ä–≤–∏—Å–∞ –≤ —Ç–µ–∫—É—â–µ–π –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏. –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –≤—ã–∑–æ–≤ —Å–µ—Ä–≤–∏—Å–∞ –≤–æ –≤–ª–æ–∂–µ–Ω–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏ –Ω–µ –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –≤ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–π –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏. –ß—Ç–æ–±—ã –æ–±–æ–π—Ç–∏ —ç—Ç—É –ø—Ä–æ–±–ª–µ–º—É, —Å–µ—Ä–≤–∏—Å –º–æ–∂–µ—Ç –Ω–∞–π—Ç–∏ —ç–∫–∑–µ–º–ø–ª—è—Ä —Å–∞–º–æ–≥–æ —Å–µ–±—è –≤ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–π –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏ –∏ –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞—Ç—å –µ–≥–æ.

**–ü—Ä–∏–º–µ—Ä**

–ü—Ä–µ–¥–ø–æ–ª–æ–∂–∏–º, —á—Ç–æ –º—ã —Å–Ω–æ–≤–∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ–º –±–∏–±–ª–∏–æ—Ç–µ–∫—É logger –¥–ª—è –ª–µ–Ω–∏–≤–æ–≥–æ –º–∞—Ä—à—Ä—É—Ç–∞:

```ts
export const FLIGHT_BOOKING_ROUTES: Routes = [
    {
        path: '',
        component: FlightBookingComponent,
        canActivate: [
            () => inject(AuthService).isAuthenticated(),
        ],
        providers: [
            // NGRX
            provideState(bookingFeature),
            provideEffects([BookingEffects]),

            // Providing **another** logger for this part of the app:
            provideLogger(
                {
                    level: LogLevel.DEBUG,
                    chaining: true,
                    appenders: [DefaultLogAppender],
                },
                withColor({
                    debug: 42,
                    error: 43,
                    info: 46,
                })
            ),
        ],
        children: [
            {
                path: 'flight-search',
                component: FlightSearchComponent,
            },
            /* [...] */
        ],
    },
];
```

–≠—Ç–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç **–¥—Ä—É–≥–æ–π** –Ω–∞–±–æ—Ä —Å–µ—Ä–≤–∏—Å–æ–≤ Logger –≤ –∏–Ω–∂–µ–∫—Ç–æ—Ä–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è —ç—Ç–æ–≥–æ –ª–µ–Ω–∏–≤–æ–≥–æ –º–∞—Ä—à—Ä—É—Ç–∞ –∏ –µ–≥–æ –¥–æ—á–µ—Ä–Ω–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤. –≠—Ç–∏ —Å–µ—Ä–≤–∏—Å—ã —è–≤–ª—è—é—Ç—Å—è —Ç–µ–Ω—å—é —Å–≤–æ–∏—Ö –∞–Ω–∞–ª–æ–≥–æ–≤ –≤ –∫–æ—Ä–Ω–µ–≤–æ–π –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏. –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –∫–æ–≥–¥–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –≤ –ª–µ–Ω–∏–≤–æ–π –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏ –≤—ã–∑—ã–≤–∞–µ—Ç `LoggerService`, —Å–µ—Ä–≤–∏—Å—ã –≤ –∫–æ—Ä–Ω–µ–≤–æ–π –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏ –Ω–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç.

–ß—Ç–æ–±—ã –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç—å —ç—Ç–æ, –º—ã –º–æ–∂–µ–º –ø–æ–ª—É—á–∏—Ç—å `LoggerService` –∏–∑ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–π –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏. –¢–æ—á–Ω–µ–µ, —ç—Ç–æ –Ω–µ _—Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π_ scope, –∞ "–±–ª–∏–∂–∞–π—à–∏–π –ø—Ä–µ–¥–∫–æ–≤—ã–π scope", –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—â–∏–π `LoggerService`. –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ —Å–ª—É–∂–±–∞ –º–æ–∂–µ—Ç –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª–Ω–æ–º–æ—á–∏—è —Å–≤–æ–µ–º—É —Ä–æ–¥–∏—Ç–µ–ª—é. –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, —Å–µ—Ä–≤–∏—Å—ã —Å–≤—è–∑—ã–≤–∞—é—Ç—Å—è –≤ —Ü–µ–ø–æ—á–∫—É:

```ts
@Injectable()
export class LoggerService {
    private appenders = inject(LOG_APPENDERS);
    private formatter = inject(LogFormatter);
    private config = inject(LoggerConfig);

    private parentLogger = inject(LoggerService, {
        optional: true,
        skipSelf: true,
    });
    /* [...] */

    log(
        level: LogLevel,
        category: string,
        msg: string
    ): void {
        // 1. –î–µ–ª–∞–π—Ç–µ –∑–¥–µ—Å—å —Å–≤–æ–∏ –¥–µ–ª–∞
        /* [...] */

        // 2. –ü–µ—Ä–µ–¥–∞—Ç—å —Ä–æ–¥–∏—Ç–µ–ª—è–º
        if (this.config.chaining && this.parentLogger) {
            this.parentLogger.log(level, category, msg);
        }
    }
    /* [...] */
}
```

–ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ inject –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ `LoggerService`, –Ω–∞–º –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å `optional: true`, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –∏—Å–∫–ª—é—á–µ–Ω–∏—è, –µ—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ—Ç—Å—è –Ω–∏ –æ–¥–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏-–ø—Ä–µ–¥–∫–∞ —Å `LoggerService`. –ü–µ—Ä–µ–¥–∞—á–∞ `skipSelf: true` –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –ø–æ–∏—Å–∫ –±—É–¥–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –≤ –æ–±–ª–∞—Å—Ç—è—Ö-–ø—Ä–µ–¥—à–µ—Å—Ç–≤–µ–Ω–Ω–∏–∫–∞—Ö. –í –ø—Ä–æ—Ç–∏–≤–Ω–æ–º —Å–ª—É—á–∞–µ Angular –Ω–∞—á–Ω–µ—Ç –ø–æ–∏—Å–∫ —Å —Ç–µ–∫—É—â–µ–≥–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ –∏ –ø–æ–ª—É—á–∏—Ç –≤—ã–∑—ã–≤–∞—é—â–∏–π —Å–µ—Ä–≤–∏—Å —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ.

–ö—Ä–æ–º–µ —Ç–æ–≥–æ, –ø—Ä–∏–º–µ—Ä, –ø–æ–∫–∞–∑–∞–Ω–Ω—ã–π –∑–¥–µ—Å—å, –ø–æ–∑–≤–æ–ª—è–µ—Ç –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å/–¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å —ç—Ç–æ –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Å –ø–æ–º–æ—â—å—é –Ω–æ–≤–æ–≥–æ —Ñ–ª–∞–≥–∞ `chaining` –≤ `LoggerConfiguration`.

**–°–ª—É—á–∞–∏ –∏ –≤–∞—Ä–∏–∞—Ü–∏–∏**

-   –í `HttpClient` —ç—Ç–æ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–∞–∫–∂–µ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ `HttpInterceptors` –≤ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏—Ö –¥–∏–∞–ø–∞–∑–æ–Ω–∞—Ö. –ë–æ–ª–µ–µ –ø–æ–¥—Ä–æ–±–Ω–æ –æ [—Ü–µ–ø–æ—á–∫–µ HttpInterceptors](https://www.angulararchitects.io/aktuelles/the-refurbished-httpclient-in-angular-15-standalone-apis-and-functional-interceptors/) –º–æ–∂–Ω–æ –ø—Ä–æ—á–∏—Ç–∞—Ç—å [–∑–¥–µ—Å—å](https://www.angulararchitects.io/aktuelles/the-refurbished-httpclient-in-angular-15-standalone-apis-and-functional-interceptors/). –ó–¥–µ—Å—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Ü–µ–ø–æ—á–∫–∏ –º–æ–∂–µ—Ç –±—ã—Ç—å –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–æ —Å –ø–æ–º–æ—â—å—é –æ—Ç–¥–µ–ª—å–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏. –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏, —ç—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –¥—Ä—É–≥–æ–π –ø–µ—Ä–µ—Ö–≤–∞—Ç—á–∏–∫, –¥–µ–ª–µ–≥–∏—Ä—É—é—â–∏–π —Ñ—É–Ω–∫—Ü–∏–∏ –≤ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–π –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏.

## –ü–∞—Ç—Ç–µ—Ä–Ω: –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–∏—Å {#leanpub-auto-pattern-functional-service}

**–ù–∞–º–µ—Ä–µ–Ω–∏—è**

-   –°–¥–µ–ª–∞—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫ –±–æ–ª–µ–µ –ª–µ–≥–∫–∏–º –∑–∞ —Å—á–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–π –≤ –∫–∞—á–µ—Å—Ç–≤–µ —Å–µ—Ä–≤–∏—Å–æ–≤
-   –°–æ–∫—Ä–∞—â–µ–Ω–∏–µ –Ω–µ–ø—Ä—è–º—ã—Ö —Å–≤—è–∑–µ–π –∑–∞ —Å—á–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π.

**–û–ø–∏—Å–∞–Ω–∏–µ**

–í–º–µ—Å—Ç–æ —Ç–æ–≥–æ, —á—Ç–æ–±—ã –∑–∞—Å—Ç–∞–≤–ª—è—Ç—å –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è —Ä–µ–∞–ª–∏–∑–æ–≤—ã–≤–∞—Ç—å —Å–µ—Ä–≤–∏—Å –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–ª–∞—Å—Å–∞, —Å–ª–µ–¥—É—è –∑–∞–¥–∞–Ω–Ω–æ–º—É –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É, –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ —Ç–∞–∫–∂–µ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏–∏. –í–Ω—É—Ç—Ä–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –æ–Ω–∏ –º–æ–≥—É—Ç –±—ã—Ç—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã –∫–∞–∫ —Å–µ—Ä–≤–∏—Å —Å –ø–æ–º–æ—â—å—é `useValue`.

**–ü—Ä–∏–º–µ—Ä**

–í —ç—Ç–æ–º –ø—Ä–∏–º–µ—Ä–µ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å –º–æ–∂–µ—Ç –Ω–∞–ø—Ä—è–º—É—é –ø–µ—Ä–µ–¥–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é, –¥–µ–π—Å—Ç–≤—É—é—â—É—é –∫–∞–∫ `LogFormatter`, –≤ `provideLogger`:

```ts
bootstrapApplication(AppComponent, {
    providers: [
        provideLogger(
            {
                level: LogLevel.DEBUG,
                appenders: [DefaultLogAppender],

                // Functional CSV-Formatter
                formatter: (level, cat, msg) =>
                    [level, cat, msg].join(';'),
            },
            withColor({
                debug: 3,
            })
        ),
    ],
});
```

–î–ª—è —ç—Ç–æ–≥–æ –≤ –ª–æ–≥–≥–µ—Ä–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–∏–ø `LogFormatFn`, –æ–ø—Ä–µ–¥–µ–ª—è—é—â–∏–π —Å–∏–≥–Ω–∞—Ç—É—Ä—É —Ñ—É–Ω–∫—Ü–∏–∏:

```ts
export type LogFormatFn = (
    level: LogLevel,
    category: string,
    msg: string
) => string;
```

–¢–∞–∫–∂–µ, –ø–æ—Å–∫–æ–ª—å–∫—É —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–µ –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤ –∫–∞—á–µ—Å—Ç–≤–µ —Ç–æ–∫–µ–Ω–æ–≤, –≤–≤–æ–¥–∏—Ç—Å—è `InjectionToken`:

```ts
export const LOG_FORMATTER = new InjectionToken<
    LogFormatter | LogFormatFn
>('LOG_FORMATTER');
```

–≠—Ç–æ—Ç `InjectionToken` –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∫–∞–∫ –æ—Å–Ω–æ–≤–∞–Ω–Ω—ã–µ –Ω–∞ –∫–ª–∞—Å—Å–∞—Ö `LogFormatter`, —Ç–∞–∫ –∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –Ω–µ –ª–æ–º–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥. –ö–∞–∫ —Å–ª–µ–¥—Å—Ç–≤–∏–µ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –æ–±–æ–∏—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤, `provideLogger` –¥–æ–ª–∂–µ–Ω –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –æ–±–∞ —Å–ª—É—á–∞—è –Ω–µ–º–Ω–æ–≥–æ –ø–æ-—Ä–∞–∑–Ω–æ–º—É:

```ts
export function provideLogger(
    config: Partial<LoggerConfig>,
    ...features: LoggerFeature[]
): EnvironmentProviders {
    const merged = { ...defaultConfig, ...config };

    /* [...] */

    return makeEnvironmentProviders([
        LoggerService,
        {
            provide: LoggerConfig,
            useValue: merged,
        },

        // Register LogFormatter
        //  - Functional LogFormatter:  useValue
        //  - Class-based LogFormatters: useClass
        typeof merged.formatter === 'function'
            ? {
                  provide: LOG_FORMATTER,
                  useValue: merged.formatter,
              }
            : {
                  provide: LOG_FORMATTER,
                  useClass: merged.formatter,
              },

        merged.appenders.map((a) => ({
            provide: LOG_APPENDERS,
            useClass: a,
            multi: true,
        })),
        /* [...] */
    ]);
}
```

–í —Ç–æ –≤—Ä–µ–º—è –∫–∞–∫ —Å–µ—Ä–≤–∏—Å—ã, –æ—Å–Ω–æ–≤–∞–Ω–Ω—ã–µ –Ω–∞ –∫–ª–∞—Å—Å–∞—Ö, —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—Ç—Å—è —Å –ø–æ–º–æ—â—å—é `useClass`, –¥–ª—è –∏—Ö —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –∞–Ω–∞–ª–æ–≥–æ–≤ –ø–æ–¥—Ö–æ–¥–∏—Ç `useValue`.

–ö—Ä–æ–º–µ —Ç–æ–≥–æ, –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏ `LogFormatter` –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≥–æ—Ç–æ–≤—ã –∫–∞–∫ –∫ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–º—É, —Ç–∞–∫ –∏ –∫ –∫–ª–∞—Å—Å–æ–≤–æ–º—É –ø–æ–¥—Ö–æ–¥—É:

```ts
@Injectable()
export class LoggerService {
    private appenders = inject(LOG_APPENDERS);
    private formatter = inject(LOG_FORMATTER);
    private config = inject(LoggerConfig);

    /* [...] */

    private format(
        level: LogLevel,
        category: string,
        msg: string
    ): string {
        if (typeof this.formatter === 'function') {
            return this.formatter(level, category, msg);
        } else {
            return this.formatter.format(
                level,
                category,
                msg
            );
        }
    }

    log(
        level: LogLevel,
        category: string,
        msg: string
    ): void {
        if (level < this.config.level) {
            return;
        }

        const formatted = this.format(level, category, msg);

        /* [...] */
    }
    /* [...] */
}
```

**–°–ª—É—á–∞–∏ –∏ –≤–∞—Ä–∏–∞—Ü–∏–∏**

-   `HttpClient` –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ—Ö–≤–∞—Ç—á–∏–∫–∏. –û–Ω–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ —Ñ—É–Ω–∫—Ü–∏—é (—Å–º. –ø–∞—Ç—Ç–µ—Ä–Ω _Feature_).
-   –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä `Router` –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –æ—Ö—Ä–∞–Ω–Ω–∏–∫–æ–≤ –∏ —Ä–µ–∑–æ–ª–≤–µ—Ä–æ–≤.

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ {#leanpub-auto-conclusion-6}

–§–∞–±—Ä–∏–∫–∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ ‚Äî —ç—Ç–æ –ø—Ä–æ—Å—Ç—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏, –≤–æ–∑–≤—Ä–∞—â–∞—é—â–∏–µ –º–∞—Å—Å–∏–≤ —Å –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º–∏. –û–Ω–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –≤—Å–µ—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤, –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–¥—Å–∏—Å—Ç–µ–º—ã –∏–ª–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏. –ü–æ —É—Å–ª–æ–≤–∏—é, —Ç–∞–∫–∏–µ —Ñ–∞–±—Ä–∏–∫–∏ –∏–º–µ—é—Ç —à–∞–±–ª–æ–Ω –∏–º–µ–Ω–æ–≤–∞–Ω–∏—è `privateXY`.

–§–∞–±—Ä–∏–∫–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ –º–æ–∂–µ—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å –æ–±—ä–µ–∫—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏ –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏. –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è ‚Äî —ç—Ç–æ –¥—Ä—É–≥–∞—è —Ñ—É–Ω–∫—Ü–∏—è, –≤–æ–∑–≤—Ä–∞—â–∞—é—â–∞—è –≤—Å–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã, –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–ª—è –¥–∞–Ω–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏. –ò—Ö –∏–º–µ–Ω–∞ —Å–ª–µ–¥—É—é—Ç —à–∞–±–ª–æ–Ω—É –∏–º–µ–Ω–æ–≤–∞–Ω–∏—è `withXYZ`.

–î–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `ENVIRONMENT_INITIALIZER`, –∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ inject –≤–º–µ—Å—Ç–µ —Å —Ç–∞–∫–∏–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏, –∫–∞–∫ `optional` –∏ `skipSelf`, –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–∑–¥–∞—Ç—å —Ü–µ–ø–æ—á–∫—É —Å –¥—Ä—É–≥–∏–º —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–º —Ç–æ–≥–æ –∂–µ —Å–µ—Ä–≤–∏—Å–∞ –≤ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–π –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏.
